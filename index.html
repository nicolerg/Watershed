<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Prioritization of functional rare genetic variants by integrating
    genomic annotations and RNA-seq • WatershedR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Prioritization of functional rare genetic variants by integrating
    genomic annotations and RNA-seq">
<meta property="og:description" content="Watershed is an unsupervised probabilistic framework that
    integrates genomic annotations and RNA-seq outlier calls to identify
    the probability a rare variant has a functional effect on a particular
    RNA-seq outlier phenotype (examples of outlier phenotypes can be, but
    are not limited to total expression, splicing, or ASE). Watershed
    extends our previous model RIVER (which can also be run via this
    package) by incoorperating information from multiple outlier
    phenoytpes into one model, where predictions for functional effects in
    one outlier phenotype are informed by observed outlier calls in
    another phenotype.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">WatershedR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/nicolerg/WatershedR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="watershed">Watershed<a class="anchor" aria-label="anchor" href="#watershed"></a>
</h1></div>
<p>Watershed is an unsupervised probabilistic framework that integrates genomic annotations and RNA-seq outlier calls to identify the probability a rare variant has a functional effect on a particular RNA-seq outlier phenotype (examples of outlier phenotypes can be, but are not limited to total expression, splicing, or ASE). Watershed extends our previous model RIVER (which can also be run via this package) by incoorperating information from multiple outlier phenoytpes into one model, where predictions for functional effects in one outlier phenotype are informed by observed outlier calls in another phenotype. Please see [ref bioRxiv preprint] for more details.</p>
<div class="section level2">
<h2 id="input-file">Input file<a class="anchor" aria-label="anchor" href="#input-file"></a>
</h2>
<p>Watershed models instances of gene-individual pairs. Therefor each line in the Watershed input file must be a gene-individual pair. Each line must include a minimum of one genomic annotation describing the rare variants nearby the gene for that individual. Each line must also include a minimum of one outlier score (p-value) describing the gene-individual pair. To evaluate Watershed performance we rely on N2 pairs, or pairs of individuals that share the same rare genetic variant nearby a particular gene (see bioRxiv preprint for more details). Therefor, each line in the input file must contain a column concerning whether the gene-individual is an N2 pair. If the gene-individual is not an N2 pair, it can be represented as “NA”. If the gene-individual is in an N2 pair, it can be represented as a positive integer that represents the unique identifier for that N2 pair. Note: if there are more than two individauls with the same rare genetic variant, you must randomly select two individuals and ignore all other individuals.</p>
<p>More formally, assuming G genomic annotations and E outlier p-values, the columns of the Watershed input file are as follows (column ordering is essential): 1. “SubjectID”: Identifier for the individual in the gene-individual pair 2. “GeneName”: Identifier for the gene in the gene-individual pair 3. A column for each of the G genomic annotations. Header names of these columns can be entirely user specified. Values are real valued. 4. A column for each of the E outlier p-values. Header names of these columns can be entirely user specified. Values are p-values (ie [0,1]). It is ok to have missing/unobserved values. If an outlier is missing for a gene-individual pair, use “NaN” for that element. 5. “N2pair”: Identifier for whether gene-individual is in an N2 pair. If it is not, use “NA”. If it is an N2 pair, use a unique positive integer to identify the pair.</p>
<p>An example input file with 18 genomic annotations and 3 outlier p-values can be found in “example_data/watershed_example_data.txt”. Another example input file with 18 genomic annotations and 1 outlier p-value can be found in “example_data/river_example_data_pheno_1.txt”</p>
<p>Note on outlier p-values: We can explicitely model outlier calls with sign/direction (ie. total expression outliers are generated from a zscore and can therefor be over-expression or under-expression). To model this, if a particular outlier signal has sign/direction, simply put a negative sign in front of the p-value for instances that are under-expression and keep the over-expression outliers as postive valued. An exmample of this can be seen in the “pheno_2_pvalue” column of “example_data/watershed_example_data.txt”.</p>
</div>
<div class="section level2">
<h2 id="running-watershed">Running Watershed<a class="anchor" aria-label="anchor" href="#running-watershed"></a>
</h2>
<p>There are two main scripts useful to user looking to apply Watershed to their data: 1. <em>evaluate_watershed.R</em>: Briefly, this script will train a Watershed model on non-N2 pairs, and evaluate (via precision recall curves) on held-out N2 pairs. This will allow the user to get an idea of the accuracy of Watershed applied to their data. 2. <em>predict_watershed.R</em>: Briefly, this script allows a user to train a Watershed model on training data, and then predict Watershed posterior probabilities (using Watershed parameters optimized in training) on all gene-individual in a much larger prediction data set.</p>
</div>
<div class="section level2">
<h2 id="running-evaluate_watershedr">Running evaluate_watershed.R<a class="anchor" aria-label="anchor" href="#running-evaluate_watershedr"></a>
</h2>
<p>evaluate_watershed.R can be easily run by using the following command:</p>
<p>Rscript evaluate_watershed.R –input <em>input_file_name</em> –number_dimensions <em>number_of_dimensions</em> –output_prefix <em>output_prefix</em> –model_name <em>model</em> –dirichlet_prior_parameter <em>dirichlet_prior</em> –l2_prior_parameter <em>l2_prior</em> –binary_pvalue_threshold <em>pvalue_threshold</em> –n2_pair_pvalue_fraction <em>pvalue_fraction</em></p>
<p>where: 1. <em>input_file_name</em> is a string corresponding to the filename of the Watershed input file 2. <em>number_of_dimensions</em> is an integer representing the number of outlier types (variable E in “input file” section) 3. <em>output_prefix</em> is a string corresponding to the prefix of all output files generated by evaluate_watershed.R 4. <em>model</em> is string identifier corresponding to the model to use. Options are “RIVER”, “Watershed_exact”, and “Watershed_approximate” 5. <em>dirichlet_prior</em> is a float that controls the strength of the symmetric Dirichlet prior placed on the categorical distribution P(E|Z). We recommend using a value of 10.0. 6. <em>l2_prior</em> is a float defining the L2 (gaussian) distribution that acts as a prior on the parameters defining the conditional random field P(Z|G). If set to NA, Watershed will run a grid search on held-out data to select an optimal L2 prior. We recommend setting this parameter to NA. 7. <em>pvalue_threshold</em> is a float that determines the threshold used to binarizee outliers for the Genomic Annotation model. We recommend setting this parameter to .01. 8. <em>pvalue_fraction</em> is float to determine the fraction of genes (based on rank) that are considered outliers for N2 pair analysis. This is done so each outlier signal/type has approximately the same distribution of positive outlier instances. We recommend setting this parameter to .01.</p>
<p>“Watershed_exact” is Watershed where parameters are optimized via exact inference (tractable and recommended when the number of dimensions (E) is small. A general rule of thumb is if the number of dimensions (E) is less than equal to 4, exact inference should be used). “Watershed_approximate” is Watershed where parameters are optimized using approximate inference. This approach is tractable when the number of dimensions (E) is large. For example, we used this to model the related outlier signals from 49 tissues (see bioRxiv preprint).</p>
<p>There are several other command line arguments (including model hyperparameter settings) that can be specified. A description can be found in “evaluate_watershed.R”.</p>
<p>An example shell script that calls ‘evaluate_watershed.R’ can be found in ‘driver.sh’.</p>
</div>
<div class="section level2">
<h2 id="evaluate_watershedr-deliverables">evaluate_watershed.R deliverables<a class="anchor" aria-label="anchor" href="#evaluate_watershedr-deliverables"></a>
</h2>
<p>Running evaluate_watershed.R will save an R object to <em>output_prefix</em> + ‘evaluation_object.rds’. This object can be accesed in R with the following command:</p>
<p>evaluation_object &lt;- readRDS(evaluation_object_file_name)</p>
<p>Once loaded, the object can be accessed via the following:</p>
<ul>
<li>evaluation_object$model_params contains all of the optimized Watershed parameters.</li>
<li>evaluation_object$gam_model_params contains all optimized GAM parameters</li>
<li>evaluation_object$auc contains information on evaluation (precion-recall stats, etc)</li>
<li>evaluation_object<span class="math inline"><em>a</em><em>u</em><em>c</em>[[1]]</span>evaROC$watershed_pr_auc gives the area under the precision recall curve (for Watershed/RIVER) in the first outlier dimension (base 1)</li>
<li>evaluation_object<span class="math inline"><em>a</em><em>u</em><em>c</em>[[3]]</span>evaROC$watershed_pr_auc gives the area under the precision recall curve (for Watershed/RIVER) in the third outlier dimension (base 1)</li>
<li>evaluation_object<span class="math inline"><em>a</em><em>u</em><em>c</em>[[1]]</span>evaROC$GAM_pr_auc gives the area under the precision recall curve (for GAM) in the first outlier dimension (base 1)</li>
<li>evaluation_object<span class="math inline"><em>a</em><em>u</em><em>c</em>[[1]]</span>evaROC$watershed_precision gives a vector of precision values (for Watershed/RIVER) in the first outlier dimension (base 1). The vector spans posterior thresholds generated by the R library “PRROC”</li>
<li>evaluation_object<span class="math inline"><em>a</em><em>u</em><em>c</em>[[1]]</span>evaROC$watershed_recall gives a vector of recall values (for Watershed/RIVER) in the first outlier dimension (base 1). This vector is the same length as precision vector above (and can be therefor used together to make a PR-curve). The vector spans posterior thresholds generated by the R library “PRROC”</li>
<li>evaluation_object<span class="math inline"><em>a</em><em>u</em><em>c</em>[[1]]</span>evaROC$GAM_precision gives a vector of precision values (for GAM) in the first outlier dimension (base 1). The vector spans posterior thresholds generated by the R library “PRROC”</li>
<li>evaluation_object<span class="math inline"><em>a</em><em>u</em><em>c</em>[[1]]</span>evaROC$GAM_recall gives a vector of recall values (for GAM) in the first outlier dimension (base 1). This vector is the same length as precision vector above (and can be therefor used together to make a PR-curve). The vector spans posterior thresholds generated by the R library “PRROC”</li>
</ul>
</div>
<div class="section level2">
<h2 id="running-predict_watershedr">Running predict_watershed.R<a class="anchor" aria-label="anchor" href="#running-predict_watershedr"></a>
</h2>
<p>predict_watershed.R can be easily run by using the following command:</p>
<p>Rscript predict_watershed.R –training_input <em>training_input_file</em> –prediction_input <em>prediction_input_file</em> –number_dimensions <em>number_of_dimensions</em> –output_prefix <em>output_prefix</em> –model_name <em>model</em> –dirichlet_prior_parameter <em>dirichlet_prior</em> –l2_prior_parameter <em>l2_prior</em> –binary_pvalue_threshold <em>pvalue_threshold</em></p>
<p>where: 1. <em>training_input_file</em> is the filename of the Watershed input file used to train Watershed. 2. <em>prediction_input_file</em> is the filename of the Watershed input file containing instances to make predictions on. It must be the same structure (ie. same genomic annotations and same outlier calls) as the $training_input_file. 3. <em>number_of_dimensions</em> is an integer representing the number of outlier types (variable E in “input file” section) 4. <em>output_prefix</em> is the prefix of all output files generated by evaluate_watershed.R 5. <em>model</em> is string identifier corresponding to the model to use. Options are “RIVER”, “Watershed_exact”, and “Watershed_approximate” 6. <em>dirichlet_prior</em> is a float that controls the strength of the symmetric Dirichlet prior placed on the categorical distribution P(E|Z). We recommend using a value of 10.0. 7. <em>l2_prior</em> is a float defining the L2 (gaussian) distribution that acts as a prior on the parameters defining the conditional random field P(Z|G). If set to NA, Watershed will run a grid search on held-out data to select an optimal L2 prior. We recommend setting this parameter to NA. 8. <em>pvalue_threshold</em> is a float that determines the threshold used to binarizee outliers for the Genomic Annotation model. We recommend setting this parameter to .01.</p>
<p>“Watershed_exact” is Watershed where parameters are optimized via exact inference (tractable and recommended when E is small. A general rule of thumb is if E is less than equal to 4, exact inference should be used). “Watershed_approximate” is Watershed where parameters are optimized using approximate inference. This approach is tractable when E is large. For example, we used this to model the related outlier signals from 49 tissues (see bioRxiv preprint).</p>
<p>There are several other command line arguments (including model hyperparameter settings) that can be specified. A description can be found in “predict_watershed.R”.</p>
<p>An example shell script that calls ‘predict_watershed.R’ can be found in ‘driver.sh’.</p>
</div>
<div class="section level2">
<h2 id="predict_watershedr-deliverables">predict_watershed.R deliverables<a class="anchor" aria-label="anchor" href="#predict_watershedr-deliverables"></a>
</h2>
<p>Running predict_watershed.R will save a tab-seperated file to <span class="math inline">$output_prefix"posterior_probability.txt". Each line of this file corresponds to an instance (a line) in the prediction input file ($</span>prediction_input_file). Each line has the following columns: 1. “sample_names”: Identifier the gene-individual pair corresponding to the given line. 2. A column for each of the E outliers. Where the column corresponding to outlier e, represents the Watershed marginal posterior probability for outier e.</p>
</div>
<div class="section level2">
<h2 id="dependencies-and-testing-environment">Dependencies and Testing environment<a class="anchor" aria-label="anchor" href="#dependencies-and-testing-environment"></a>
</h2>
<ul>
<li>R 3.5.1</li>
<li>R package Rcpp (1.0.2)</li>
<li>R package lbfgs (1.2.1)</li>
<li>R package PRROC (1.3.1)</li>
<li>R package optparse (1.6.4)</li>
</ul>
</div>
<div class="section level2">
<h2 id="authors">Authors<a class="anchor" aria-label="anchor" href="#authors"></a>
</h2>
<ul>
<li>
<strong>Ben Strober</strong> – <a href="https://github.com/BennyStrobes" class="external-link">BennyStrobes</a> – <a href="mailto:bstrober3@gmail.com" class="email">bstrober3@gmail.com</a>
</li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/nicolerg/WatershedR/" class="external-link">Browse source code</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing WatershedR</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Ben Strober <br><small class="roles"> Author </small>  </li>
<li>Nicole Gay <br><small class="roles"> Maintainer, contributor </small>  </li>
</ul>
</div>



  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Ben Strober, Nicole Gay.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
