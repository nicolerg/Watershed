<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Evaluate Watershed — evaluate_watershed • WatershedR</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Evaluate Watershed — evaluate_watershed"><meta property="og:description" content="Train model on non-N2 pairs and evaluate model on held-out N2-pairs. 
This allows the user to get an idea of the accuracy of Watershed applied to their data."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">WatershedR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/nicolerg/WatershedR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Evaluate Watershed</h1>
    <small class="dont-index">Source: <a href="https://github.com/nicolerg/WatershedR/blob/HEAD/R/evaluate_watershed.R" class="external-link"><code>R/evaluate_watershed.R</code></a></small>
    <div class="hidden name"><code>evaluate_watershed.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Train model on non-N2 pairs and evaluate model on held-out N2-pairs. 
This allows the user to get an idea of the accuracy of Watershed applied to their data.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">evaluate_watershed</span><span class="op">(</span></span>
<span>  <span class="va">input_file</span>,</span>
<span>  <span class="va">model_name</span>,</span>
<span>  number_of_dimensions <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  dirichlet_prior <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  l2_prior_parameter <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  output_prefix <span class="op">=</span> <span class="st">"watershed"</span>,</span>
<span>  n2_pair_pvalue_fraction <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  binary_pvalue_threshold <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  lambda_costs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.01</span>, <span class="fl">0.001</span><span class="op">)</span>,</span>
<span>  nfolds <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  vi_step_size <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  vi_threshold <span class="op">=</span> <span class="fl">1e-08</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>input_file</dt>
<dd><p>String corresponding to the file name of the Watershed input file.
Either a file path or a URL. See details for required format.</p></dd>


<dt>model_name</dt>
<dd><p>String identifier corresponding to the model to use. 
Options are "RIVER", "Watershed_exact", and "Watershed_approximate"</p></dd>


<dt>number_of_dimensions</dt>
<dd><p>Integer representing the number of outlier types. 
Sometimes referred to as <code>E</code> in our documentation.</p></dd>


<dt>dirichlet_prior</dt>
<dd><p>Float parameter defining Dirichlet distribution that acts 
as a prior a Phi (the model parameters defining E|Z)</p></dd>


<dt>l2_prior_parameter</dt>
<dd><p>Float defining the L2 (gaussian) distribution that acts 
as a prior on the parameters defining the conditional random field P(Z|G). 
If set to NULL, Watershed will run a grid search on held-out data to select an 
optimal L2 prior. We recommend setting this parameter to NULL. Default: NULL</p></dd>


<dt>output_prefix</dt>
<dd><p>String corresponding to the prefix of all output files generated by this function</p></dd>


<dt>n2_pair_pvalue_fraction</dt>
<dd><p>Float. Fraction of outliers (based on rank) that are 
considered an outlier for N2 pair analysis (this is done so each outlier type/signal 
has approximately the same distribution of positive outlier examples). Default: 0.1</p></dd>


<dt>binary_pvalue_threshold</dt>
<dd><p>Float. Absolute p-value threshold used to create 
binary outliers used for Genomic Annotation Model. Default: 0.1</p></dd>


<dt>lambda_costs</dt>
<dd><p>Numeric vector of length 3. If <code>l2_prior_parameter</code> is NULL, 
perform grid search over the following values of lambda to determine optimal lambda.
Default: <code>c(.1, .01, 1e-3)</code></p></dd>


<dt>nfolds</dt>
<dd><p>Integer. If <code>l2_prior_parameter</code> is NULL, Number of folds 
to be used in K-fold cross validation for Genomic annotation model. Default: 5</p></dd>


<dt>vi_step_size</dt>
<dd><p>Float. Parameter used for Variational Optimization. 
Only applies if <code>model_name == "Watershed_approximate"</code>. Default: 0.8</p></dd>


<dt>vi_threshold</dt>
<dd><p>Float. Parameter used for Variational Optimization. 
Only applies if <code>model_name == "Watershed_approximate"</code>. Default: 1e-8</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A named list:</p><ul><li><p><code>model_params</code>contains all of the optimized Watershed parameters</p></li>
<li><p><code>gam_model_params</code>contains all optimized GAM parameters</p></li>
<li><p><code>auc</code>contains information on evaluation (precion-recall stats, etc)</p><ul><li><p><code>auc[[1]]$evaROC$watershed_pr_auc</code>gives the area under the precision recall curve 
        (for Watershed/RIVER) in the first outlier dimension (base 1)</p></li>
<li><p><code>auc[[3]]$evaROC$watershed_pr_auc</code>gives the area under the precision recall curve 
        (for Watershed/RIVER) in the third outlier dimension (base 1)</p></li>
<li><p><code>auc[[1]]$evaROC$GAM_pr_auc</code>gives the area under the precision recall curve 
        (for GAM) in the first outlier dimension (base 1)</p></li>
<li><p><code>auc[[1]]$evaROC$watershed_precision</code>gives a vector of precision values 
        (for Watershed/RIVER) in the first outlier dimension (base 1). The vector 
        spans posterior thresholds generated by the R library "PRROC"</p></li>
<li><p><code>auc[[1]]$evaROC$watershed_recall</code>gives a vector of recall values (for Watershed/RIVER) 
        in the first outlier dimension (base 1). This vector is the same length as precision vector above 
        (and can be therefor used together to make a PR-curve). 
        The vector spans posterior thresholds generated by the R library "PRROC"</p></li>
<li><p><code>auc[[1]]$evaROC$GAM_precision</code>gives a vector of precision values (for GAM) 
        in the first outlier dimension (base 1). The vector spans posterior 
        thresholds generated by the R library "PRROC"</p></li>
<li><p><code>auc[[1]]$evaROC$GAM_recall</code>gives a vector of recall values 
        (for GAM) in the first outlier dimension (base 1). This vector is the same 
        length as precision vector above (and can be therefor used together to make a PR-curve). 
        The vector spans posterior thresholds generated by the R library "PRROC"</p></li>
</ul></li>
</ul></div>
    <div id="details">
    <h2>Details</h2>
    <p>"Watershed_exact" is Watershed where parameters are optimized via exact inference 
(tractable and recommended when the number of dimensions (E) is small. 
A general rule of thumb is if the number of dimensions (E) is less than equal to 4, 
exact inference should be used). "Watershed_approximate" is Watershed where parameters 
are optimized using approximate inference. This approach is tractable when the 
number of dimensions (E) is large.</p>
<p>Watershed models instances of gene-individual pairs. Therefore each line in the 
Watershed input file must be a gene-individual pair. Each line must include a 
minimum of one genomic annotation describing the rare variants nearby the gene 
for that individual. Each line must also include a minimum of one outlier score 
(p-value) describing the gene-individual pair. To evaluate Watershed performance 
we rely on N2 pairs, or pairs of individuals that share the same rare genetic 
variant nearby a particular gene (see <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7646251/" class="external-link">the publication</a> for more details). 
Therefore, each line in the input file must contain a column concerning whether 
the gene-individual is an N2 pair. If the gene-individual is not an N2 pair, 
it can be represented as "NA". If the gene-individual is in an N2 pair, it can 
be represented as a positive integer that represents the unique identifier for 
that N2 pair.</p>
<p>Note: if there are more than two individuals with the same rare 
genetic variant, you must randomly select two individuals and ignore all other 
individuals.</p>
<p>More formally, assuming G genomic annotations and E outlier p-values, the columns 
of the Watershed input file are as follows (column ordering is essential):</p><dl><dt><code>SubjectID</code></dt>
<dd><p>Identifier for the individual in the gene-individual pair</p></dd>

  <dt><code>GeneName</code></dt>
<dd><p>Identifier for the gene in the gene-individual pair</p></dd>

  <dt><code>\[Genomic Annotation\]</code></dt>
<dd><p>A column for each of the G genomic annotations. 
    Header names of these columns can be entirely user specified. Values are real valued.</p></dd>

  <dt><code>\[E outlier p-values\]</code></dt>
<dd><p>A column for each of the E outlier p-values. 
    Header names of these columns can be entirely user specified. Values are p-values (i.e., \[0,1\]). 
    It is okay to have missing/unobserved values. If an outlier is missing for a gene-individual pair, 
    use "NaN" for that element.</p></dd>

  <dt><code>N2pair</code></dt>
<dd><p>Identifier for whether gene-individual is in an N2 pair. 
    If it is not, use "NA". If it is an N2 pair, use a unique positive integer to identify the pair.</p></dd>


</dl></div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># For all examples, use example data that has 3 E outlier p-value columns, </span></span></span>
<span class="r-in"><span><span class="co"># which corresponds to number_of_dimensions = 3</span></span></span>
<span class="r-in"><span><span class="va">input</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/BennyStrobes/Watershed/"</span>,</span></span>
<span class="r-in"><span>     <span class="st">"master/example_data/watershed_example_data.txt"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Run using Watershed approximate inference</span></span></span>
<span class="r-in"><span><span class="fu">evaluate_watershed</span><span class="op">(</span>input_file <span class="op">=</span> <span class="va">input</span>,</span></span>
<span class="r-in"><span>                   model_name <span class="op">=</span> <span class="st">"Watershed_approximate"</span>, </span></span>
<span class="r-in"><span>                   number_of_dimensions <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>                   output_prefix <span class="op">=</span> <span class="st">"watershed_approximate_n3"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Run using Watershed exact inference</span></span></span>
<span class="r-in"><span><span class="fu">evaluate_watershed</span><span class="op">(</span>input_file <span class="op">=</span> <span class="va">input</span>, </span></span>
<span class="r-in"><span>                   model_name <span class="op">=</span> <span class="st">"Watershed_exact"</span>, </span></span>
<span class="r-in"><span>                   number_of_dimensions <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>                   output_prefix <span class="op">=</span> <span class="st">"watershed_exact_n3"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Run using RIVER</span></span></span>
<span class="r-in"><span><span class="fu">evaluate_watershed</span><span class="op">(</span>input_file <span class="op">=</span> <span class="va">input</span>, </span></span>
<span class="r-in"><span>                   model_name <span class="op">=</span> <span class="st">"RIVER"</span>, </span></span>
<span class="r-in"><span>                   number_of_dimensions <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>                   output_prefix <span class="op">=</span> <span class="st">"river_n3"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Ben Strober, Nicole Gay.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

